# Technical Documentation — DWADW.DIM_CITY_OTM

## Purpose
Dimension table that stores cities for the OTM domain. It includes the city business description, domain/tenant context, status management, audit fields, and ETL load tracking information.  
This table is designed for a Data Warehouse environment as a Type 1 Slowly Changing Dimension (SCD).

---

## Table Definition (DDL Reference)

CREATE TABLE DWADW.DIM_CITY_OTM (
    CITY_OTM_ID       NUMBER GENERATED BY DEFAULT AS IDENTITY,
    CITY_DESCRIPTION  VARCHAR2(960) NOT NULL,
    DOMAIN_NAME       VARCHAR2(200) NOT NULL,
    CITY_ACTIVE       CHAR(1 BYTE) DEFAULT 'A' NOT NULL
        CONSTRAINT DIM_CITY_OTM_AI_CK CHECK (CITY_ACTIVE IN ('A','I')),
    INSERT_USER       VARCHAR2(512) NOT NULL,
    INSERT_DATE       DATE NOT NULL,
    UPDATE_USER       VARCHAR2(512 BYTE),
    UPDATE_DATE       DATE,
    DIM_DOMAIN_OTM_ID NUMBER NOT NULL,
    LOAD_DATE         DATE NOT NULL
);

CREATE INDEX DWADW.DIM_CITY_OTM_IDX
    ON DWADW.DIM_CITY_OTM (CITY_DESCRIPTION ASC);

ALTER TABLE DWADW.DIM_CITY_OTM
    ADD CONSTRAINT DIM_CITY_OTM_PK
    PRIMARY KEY (CITY_OTM_ID);

ALTER TABLE DWADW.DIM_CITY_OTM
    ADD CONSTRAINT DIM_CITY_OTM_UN
    UNIQUE (CITY_DESCRIPTION);

---

## Column Description

| Column Name | Data Type | Nullable | Default | Description |
|------------|----------|----------|---------|-------------|
| CITY_OTM_ID | NUMBER (IDENTITY) | NO* | Auto-generated | Surrogate key of the city dimension. Generated automatically by Oracle Identity and used as the Primary Key. |
| CITY_DESCRIPTION | VARCHAR2(960) | NO | — | Business description or name of the city as defined in OTM. |
| DOMAIN_NAME | VARCHAR2(200) | NO | — | Logical OTM domain or tenant to which the city belongs. |
| CITY_ACTIVE | CHAR(1) | NO | 'A' | Status flag of the city: A = Active, I = Inactive. |
| INSERT_USER | VARCHAR2(512) | NO | — | User or ETL process that inserted the record. |
| INSERT_DATE | DATE | NO | — | Date and time when the record was inserted. |
| UPDATE_USER | VARCHAR2(512) | YES | — | User or ETL process that last updated the record. |
| UPDATE_DATE | DATE | YES | — | Date and time of the last update. |
| DIM_DOMAIN_OTM_ID | NUMBER | NO | — | Surrogate key referencing the OTM domain dimension. |
| LOAD_DATE | DATE | NO | — | ETL load date used for batch traceability and auditing purposes. |

*Although CITY_OTM_ID is not explicitly declared as NOT NULL, Oracle enforces non-null values because it is an IDENTITY column and a PRIMARY KEY.*

---

## Constraints

| Constraint Name | Type | Description |
|----------------|------|-------------|
| DIM_CITY_OTM_PK | Primary Key | Ensures uniqueness of each city record using CITY_OTM_ID. |
| DIM_CITY_OTM_UN | Unique | Enforces uniqueness of CITY_DESCRIPTION. |
| DIM_CITY_OTM_AI_CK | Check | Restricts CITY_ACTIVE values to A or I. |

---

## Indexes

| Index Name | Columns | Purpose |
|-----------|---------|---------|
| DIM_CITY_OTM_IDX | CITY_DESCRIPTION | Improves performance for searches, joins, and filters by city description. |

---

## ETL and Modeling Notes

- The unique constraint on CITY_DESCRIPTION may cause conflicts in multi-tenant scenarios.
  Recommended alternative uniqueness:
  UNIQUE (DIM_DOMAIN_OTM_ID, CITY_DESCRIPTION)

- DIM_DOMAIN_OTM_ID should ideally reference a domain dimension table such as:
  DWADW.DIM_DOMAIN_OTM(DIM_DOMAIN_OTM_ID)

- UPDATE_USER and UPDATE_DATE should be populated together to ensure consistent auditing.

- This table follows a Type 1 Slowly Changing Dimension (SCD) approach.

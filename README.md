# Documentación Técnica — DWADW.DIM_CITY_OTM

## Propósito
Tabla de dimensión que almacena las **ciudades** del dominio OTM. Incluye la descripción de negocio de la ciudad, el contexto de dominio/tenant, control de estado, campos de auditoría y la información de carga ETL.  
Esta tabla está diseñada para un entorno de **Data Warehouse** y sigue el patrón de **Dimensión de Cambio Lento Tipo 1 (SCD Tipo 1)**.

---

## Definición de la Tabla (Referencia DDL)

CREATE TABLE DWADW.DIM_CITY_OTM (
    CITY_OTM_ID       NUMBER GENERATED BY DEFAULT AS IDENTITY,
    CITY_DESCRIPTION  VARCHAR2(960) NOT NULL,
    DOMAIN_NAME       VARCHAR2(200) NOT NULL,
    CITY_ACTIVE       CHAR(1 BYTE) DEFAULT 'A' NOT NULL
        CONSTRAINT DIM_CITY_OTM_AI_CK CHECK (CITY_ACTIVE IN ('A','I')),
    INSERT_USER       VARCHAR2(512) NOT NULL,
    INSERT_DATE       DATE NOT NULL,
    UPDATE_USER       VARCHAR2(512 BYTE),
    UPDATE_DATE       DATE,
    DIM_DOMAIN_OTM_ID NUMBER NOT NULL,
    LOAD_DATE         DATE NOT NULL
);

CREATE INDEX DWADW.DIM_CITY_OTM_IDX
    ON DWADW.DIM_CITY_OTM (CITY_DESCRIPTION ASC);

ALTER TABLE DWADW.DIM_CITY_OTM
    ADD CONSTRAINT DIM_CITY_OTM_PK
    PRIMARY KEY (CITY_OTM_ID);

ALTER TABLE DWADW.DIM_CITY_OTM
    ADD CONSTRAINT DIM_CITY_OTM_UN
    UNIQUE (CITY_DESCRIPTION);

---

## Descripción de Columnas

| Nombre de Columna | Tipo de Dato | Nulo | Valor por Defecto | Descripción |
|------------------|--------------|------|-------------------|-------------|
| CITY_OTM_ID | NUMBER (IDENTITY) | NO* | Autogenerado | Clave sustituta de la dimensión ciudad. Generada automáticamente por Oracle Identity y usada como clave primaria. |
| CITY_DESCRIPTION | VARCHAR2(960) | NO | — | Descripción o nombre de la ciudad según la definición de negocio en OTM. |
| DOMAIN_NAME | VARCHAR2(200) | NO | — | Dominio lógico o tenant de OTM al que pertenece la ciudad. |
| CITY_ACTIVE | CHAR(1) | NO | 'A' | Estado de la ciudad: A = Activo, I = Inactivo. |
| INSERT_USER | VARCHAR2(512) | NO | — | Usuario o proceso ETL que insertó el registro. |
| INSERT_DATE | DATE | NO | — | Fecha y hora de inserción del registro. |
| UPDATE_USER | VARCHAR2(512) | SÍ | — | Usuario o proceso ETL que realizó la última actualización. |
| UPDATE_DATE | DATE | SÍ | — | Fecha y hora de la última actualización. |
| DIM_DOMAIN_OTM_ID | NUMBER | NO | — | Clave sustituta que referencia a la dimensión de dominio OTM. |
| LOAD_DATE | DATE | NO | — | Fecha de carga ETL utilizada para trazabilidad y auditoría. |

*Aunque CITY_OTM_ID no está definido explícitamente como NOT NULL, Oracle garantiza valores no nulos al ser una columna IDENTITY y clave primaria.*

---

## Restricciones

| Nombre de Restricción | Tipo | Descripción |
|----------------------|------|-------------|
| DIM_CITY_OTM_PK | Clave Primaria | Garantiza la unicidad de cada registro usando CITY_OTM_ID. |
| DIM_CITY_OTM_UN | Única | Garantiza la unicidad del campo CITY_DESCRIPTION. |
| DIM_CITY_OTM_AI_CK | Check | Restringe los valores de CITY_ACTIVE a A (Activo) o I (Inactivo). |

---

## Índices

| Nombre del Índice | Columnas | Propósito |
|------------------|----------|-----------|
| DIM_CITY_OTM_IDX | CITY_DESCRIPTION | Mejora el rendimiento en búsquedas, filtros y joins por descripción de ciudad. |

---

## Notas de ETL y Modelado

- La restricción UNIQUE sobre CITY_DESCRIPTION puede generar conflictos en escenarios multi-tenant.  
  Se recomienda usar una unicidad compuesta:
  UNIQUE (DIM_DOMAIN_OTM_ID, CITY_DESCRIPTION)

- DIM_DOMAIN_OTM_ID debería tener una clave foránea hacia una tabla de dominios, por ejemplo:
  DWADW.DIM_DOMAIN_OTM(DIM_DOMAIN_OTM_ID)

- UPDATE_USER y UPDATE_DATE deberían actualizarse conjuntamente para mantener una auditoría consistente.

- Esta dimensión sigue el patrón **SCD Tipo 1**, sobrescribiendo los valores ante cambios.

